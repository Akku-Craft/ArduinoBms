\doxysection{local\+\_\+functions.\+cpp}
\hypertarget{local__functions_8cpp_source}{}\label{local__functions_8cpp_source}\index{src/local\_functions.cpp@{src/local\_functions.cpp}}
\mbox{\hyperlink{local__functions_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ HEAD\_LOCAL\_FUNCTIONS\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ HEAD\_LOCAL\_FUNCTIONS\_H}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{head__code_8cpp}{head\_code.cpp}}"{}}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <Arduino.h>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{BMS__Definitions_8h}{BMS\_Definitions.h}}"{}}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \mbox{\hyperlink{structmeasure__Cell__Data}{measure\_Cell\_Data}}\ \mbox{\hyperlink{local__functions_8cpp_aa0b87168898bb55834be4257c9e1cf91}{read\_Data\_for\_own\_unit}}()\ \{}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structmeasure__Cell__Data}{measure\_Cell\_Data}}\ cell;}
\DoxyCodeLine{00011\ \ \ }
\DoxyCodeLine{00012\ \ \ \textcolor{comment}{//\ 1.\ MESSUNG\ (Durchschnitt\ aus\ 20\ Werten\ für\ Stabilität)}}
\DoxyCodeLine{00013\ \ \ \textcolor{keywordtype}{float}\ rawA1\ =\ 0;}
\DoxyCodeLine{00014\ \ \ \textcolor{keywordtype}{float}\ rawA2\ =\ 0;}
\DoxyCodeLine{00015\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 20;\ i++)\ \{}
\DoxyCodeLine{00016\ \ \ \ \ rawA1\ +=\ analogRead(\mbox{\hyperlink{BMS__Definitions_8h_a4ddb798fd4965c67a016006ae220fad9}{PIN\_ZELLE1}});}
\DoxyCodeLine{00017\ \ \ \ \ rawA2\ +=\ analogRead(\mbox{\hyperlink{BMS__Definitions_8h_a868bac69a83b557d4c37d10f6e59c3a5}{PIN\_GESAMT}});}
\DoxyCodeLine{00018\ \ \ \ \ delay(2);}
\DoxyCodeLine{00019\ \ \ \}}
\DoxyCodeLine{00020\ \ \ rawA1\ /=\ 20.0;}
\DoxyCodeLine{00021\ \ \ rawA2\ /=\ 20.0;}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \textcolor{comment}{//\ 2.\ UMRECHNUNG\ IN\ VOLT}}
\DoxyCodeLine{00024\ \ \ \textcolor{comment}{//\ Spannung\ von\ Zelle\ 1\ (direkt\ oder\ via\ Schutzwiderstand)}}
\DoxyCodeLine{00025\ \ \ \textcolor{keywordtype}{float}\ vZelle1\ =\ (rawA1\ *\ \mbox{\hyperlink{BMS__Definitions_8h_ad7a5b0a2de6c07b3629ea990a6741779}{V\_REF}})\ /\ 1024.0;}
\DoxyCodeLine{00026\ \ \ }
\DoxyCodeLine{00027\ \ \ \textcolor{comment}{//\ Gesamtspannung\ (Wert\ am\ Pin\ *\ 2,\ wegen\ Teiler)}}
\DoxyCodeLine{00028\ \ \ \textcolor{keywordtype}{float}\ vGesamt\ =\ ((rawA2\ *\ \mbox{\hyperlink{BMS__Definitions_8h_ad7a5b0a2de6c07b3629ea990a6741779}{V\_REF}})\ /\ 1024.0)\ *\ \mbox{\hyperlink{BMS__Definitions_8h_a5dd46831fa05337e7dc10b3f8e3d1bb5}{DIVIDER\_FAKTOR}};}
\DoxyCodeLine{00029\ \ \ }
\DoxyCodeLine{00030\ \ \ \textcolor{comment}{//\ Zelle\ 2\ berechnen\ (Differenz)}}
\DoxyCodeLine{00031\ \ \ \textcolor{keywordtype}{float}\ vZelle2\ =\ vGesamt\ -\/\ vZelle1;}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ cell.\mbox{\hyperlink{structmeasure__Cell__Data_a7836f54df2bd3abc456d196003420d0a}{voltage\_mV}}\ =\ vGesamt;}
\DoxyCodeLine{00034\ \ \ cell.\mbox{\hyperlink{structmeasure__Cell__Data_ad5b63a426d6c213060d572dd4ffcf15b}{voltage\_Cell1}}\ =\ vZelle1;}
\DoxyCodeLine{00035\ \ \ cell.\mbox{\hyperlink{structmeasure__Cell__Data_a0139a01cd1f57b433513e58e9adc35e4}{voltage\_Cell2}}\ =\ vZelle2;}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ cell.\mbox{\hyperlink{structmeasure__Cell__Data_a2a68336614b7bfcb2afec28e3b05fcc0}{temperature\_C}}\ =\ 25;}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \textcolor{keywordflow}{return}\ cell;}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \textcolor{comment}{//\ diese\ Funktion\ liest\ alle\ Regestrierten\ Zellen\ aus\ und\ legt\ fest\ was\ zu\ tun\ ist}}
\DoxyCodeLine{00044\ \textcolor{comment}{//\ die\ ergebnisse\ werden\ dan\ an\ die\ jeweilige\ Einheit\ gesendet\ wo\ auch\ die\ umsetzung\ erfolgt}}
\DoxyCodeLine{00045\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{local__functions_8cpp_a0495cc425678fc263064f3c21783260e}{update\_System\_Behavior\_for\_first\_Unit}}()\ \{}
\DoxyCodeLine{00046\ \ \ \ \ }
\DoxyCodeLine{00047\ \ \ \textcolor{comment}{//\ ueberpruefen\ ob\ balancing\ notwendig\ ist\ }}
\DoxyCodeLine{00048\ \ \ \textcolor{comment}{//\ differenz\ beider\ Akkuzellen}}
\DoxyCodeLine{00049\ \ \ \textcolor{keywordtype}{float}\ diff\ =\ \mbox{\hyperlink{head__code_8cpp_aaa77ef71859afe722986357b46304de6}{Units}}[i].\mbox{\hyperlink{structCellData_a5ae2c571bb3d77a4b574e824da8631a3}{voltage\_Cell1}}\ -\/\ \mbox{\hyperlink{head__code_8cpp_aaa77ef71859afe722986357b46304de6}{Units}}[i].\mbox{\hyperlink{structCellData_a3b299a4e2f50c8b13d8c35acd7f0484b}{voltage\_Cell2}};}
\DoxyCodeLine{00050\ \ \ }
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{//\ Frage\ 1:\ Ist\ Zelle\ 1\ viel\ voller\ als\ Zelle\ 2?}}
\DoxyCodeLine{00052\ \ \ \textcolor{keywordflow}{if}\ (diff\ >\ \mbox{\hyperlink{BMS__Definitions_8h_ac3b1397319fee50ff394c20857799d68}{diffStart}})\ \{\ }
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{head__code_8cpp_aaa77ef71859afe722986357b46304de6}{Units}}[i].is\_balancing\_Z1\ =\ \textcolor{keyword}{true};\ \ \textcolor{comment}{//\ Merken:\ Z1\ entladen}}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{head__code_8cpp_aaa77ef71859afe722986357b46304de6}{Units}}[i].is\_balancing\_Z2\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Z2\ muss\ nichts\ tun}}
\DoxyCodeLine{00055\ \ \ \}\ }
\DoxyCodeLine{00056\ \ \ \textcolor{comment}{//\ Frage\ 2:\ Ist\ Zelle\ 2\ viel\ voller\ als\ Zelle\ 1?}}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (diff\ <\ -\/\mbox{\hyperlink{BMS__Definitions_8h_ac3b1397319fee50ff394c20857799d68}{diffStart}})\ \{\ }
\DoxyCodeLine{00058\ \ \ \ \ \mbox{\hyperlink{head__code_8cpp_aaa77ef71859afe722986357b46304de6}{Units}}[i].is\_balancing\_Z1\ =\ \textcolor{keyword}{false};\ }
\DoxyCodeLine{00059\ \ \ \ \ \mbox{\hyperlink{head__code_8cpp_aaa77ef71859afe722986357b46304de6}{Units}}[i].is\_balancing\_Z2\ =\ \textcolor{keyword}{true};\ \ \textcolor{comment}{//\ Merken:\ Z2\ entladen}}
\DoxyCodeLine{00060\ \ \ \}\ }
\DoxyCodeLine{00061\ \ \ \textcolor{comment}{//\ Frage\ 3:\ Sind\ sie\ nah\ genug\ beieinander?}}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (abs(diff)\ <\ \mbox{\hyperlink{BMS__Definitions_8h_aee0998c835c86025682d05621fecf8b2}{diffStop}})\ \{\ }
\DoxyCodeLine{00063\ \ \ \ \ \mbox{\hyperlink{head__code_8cpp_aaa77ef71859afe722986357b46304de6}{Units}}[i].is\_balancing\_Z1\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00064\ \ \ \ \ \mbox{\hyperlink{head__code_8cpp_aaa77ef71859afe722986357b46304de6}{Units}}[i].is\_balancing\_Z2\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00065\ \ \ \}}
\DoxyCodeLine{00066\ \ \ }
\DoxyCodeLine{00067\ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
